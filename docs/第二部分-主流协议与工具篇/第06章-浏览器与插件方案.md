# 第6章 浏览器与插件方案

除了系统级的代理客户端，浏览器插件也是实现科学上网的重要方式。本章将介绍浏览器代理设置和常用插件的使用方法。

## 6.1 浏览器代理设置

### 6.1.1 Chrome浏览器代理

**系统代理模式：**

Chrome默认使用系统代理设置。

```
Windows：
设置 → 系统 → 代理
手动代理设置 → 输入代理服务器地址和端口

macOS：
系统偏好设置 → 网络 → 高级 → 代理
勾选"网页代理(HTTP)"和"安全网页代理(HTTPS)"
输入代理服务器：127.0.0.1:7890

Linux：
设置 → 网络 → 网络代理 → 手动
HTTP代理：127.0.0.1:7890
HTTPS代理：127.0.0.1:7890
```

**命令行启动（临时代理）：**

```bash
# Windows
chrome.exe --proxy-server="socks5://127.0.0.1:1080"

# macOS
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --proxy-server="socks5://127.0.0.1:1080"

# Linux
google-chrome --proxy-server="socks5://127.0.0.1:1080"

# 参数说明：
--proxy-server="http://127.0.0.1:7890"    # HTTP代理
--proxy-server="socks5://127.0.0.1:1080"  # SOCKS5代理
```

**快捷方式设置：**

```
Windows：
1. 右键Chrome快捷方式 → 属性
2. 目标栏添加：--proxy-server="socks5://127.0.0.1:1080"
   完整示例："C:\...\chrome.exe" --proxy-server="socks5://127.0.0.1:1080"
3. 应用 → 确定

优势：
✓ 仅浏览器走代理
✓ 不影响系统其他应用
✓ 方便切换（创建多个快捷方式）
```

### 6.1.2 Firefox浏览器代理

**内置代理设置：**

Firefox有独立的代理设置，不使用系统代理。

```
设置步骤：
1. 菜单 → 设置 → 常规
2. 滚动到底部"网络设置" → 设置
3. 选择"手动代理配置"
4. 配置代理：
   HTTP代理：127.0.0.1  端口：7890
   SOCKS主机：127.0.0.1  端口：1080
   SOCKS v5：勾选
   
5. 勾选"使用SOCKS v5时代理DNS查询"（重要！）
6. 不代理：localhost, 127.0.0.1
7. 确定
```

**配置选项说明：**

| 选项 | 说明 | 推荐 |
|-----|------|------|
| **不使用代理** | 直接连接 | 国内网络 |
| **自动检测代理** | 自动探测PAC | 不推荐 |
| **使用系统代理** | 跟随系统设置 | 推荐（配合系统代理） |
| **手动代理配置** | 手动指定代理 | 推荐（精确控制） |
| **自动代理配置URL** | 使用PAC文件 | 高级用法 |

**关键设置：**
```
必须勾选：
☑ 使用SOCKS v5时代理DNS查询
☑ 为所有协议使用相同代理

作用：
- 防止DNS泄漏
- 统一代理配置
```

### 6.1.3 Edge浏览器代理

Edge基于Chromium，代理设置与Chrome类似。

```
方式1：使用系统代理
设置 → 系统和性能 → 打开计算机的代理设置

方式2：命令行启动
msedge.exe --proxy-server="socks5://127.0.0.1:1080"

方式3：使用扩展插件（见6.2节）
```

### 6.1.4 Safari浏览器代理

Safari使用系统代理设置。

```
macOS：
系统偏好设置 → 网络 → 高级 → 代理

配置：
☑ 网页代理(HTTP)
   服务器：127.0.0.1  端口：7890
☑ 安全网页代理(HTTPS)
   服务器：127.0.0.1  端口：7890
☑ SOCKS代理
   服务器：127.0.0.1  端口：1080

要忽略这些主机与域的代理设置：
*.local, 169.254/16, localhost, 127.0.0.1
```

## 6.2 SwitchyOmega配置详解

**⚠️ 重要安全警告：**
```
重要安全提示：

近期，SwitchyOmega被曝存在安全风险事件：
- 开发者遭遇钓鱼攻击
- 插件被注入恶意代码
- 可能窃取用户私钥和敏感信息

安全建议：
✅ 确保使用最新安全版本
✅ 仅从官方Chrome应用商店下载
✅ 定期检查插件权限
✅ 考虑使用替代方案：ZeroOmega

推荐替代：ZeroOmega
- 兼容Manifest V3
- 更好的安全性
- 持续维护
- 下载：https://github.com/zero-peak/ZeroOmega
```

### 6.2.1 SwitchyOmega简介

**SwitchyOmega是什么？**

- Chrome/Edge/Firefox扩展插件
- 管理和切换多个代理配置
- 支持自动切换规则
- 开源免费

**安装方法：**

```
方案A：SwitchyOmega（传统方案）

Chrome/Edge：
1. Chrome网上应用店搜索"Proxy SwitchyOmega"
2. 或访问：https://chrome.google.com/webstore/detail/padekgcemlokbadohgkifijomclgjgif
3. 添加到Chrome

⚠️ 安全提示：
- 仅从官方应用商店安装
- 安装后检查权限设置
- 定期更新到最新版本

Firefox：
1. Firefox附加组件市场搜索"SwitchyOmega"
2. 或访问：https://addons.mozilla.org/zh-CN/firefox/addon/switchyomega/
3. 添加到Firefox

---

方案B：ZeroOmega（推荐方案）

优势：
✓ 兼容Manifest V3
✓ 更好的安全性
✓ 持续维护
✓ 功能与SwitchyOmega类似

Chrome/Edge：
1. 访问：https://chromewebstore.google.com/detail/pfnededegaaopdmhkdmcofjmoldfiped
2. 搜索"Proxy SwitchyOmega 3 (ZeroOmega)"
3. 添加到浏览器

配置方法与SwitchyOmega完全相同！
```

### 6.2.2 基础配置教程

**情景模式配置：**

**1. 新建代理情景模式**

```
步骤：
1. 点击SwitchyOmega图标 → 选项
2. 左侧"新建情景模式"
3. 情景模式名称：proxy（或任意名称）
4. 类型：代理服务器
5. 创建

配置：
代理协议：SOCKS5
代理服务器：127.0.0.1
代理端口：1080
（根据实际代理软件端口填写）

或使用HTTP代理：
代理协议：HTTP
代理服务器：127.0.0.1
代理端口：7890
```

**2. 配置自动切换模式**

```
步骤：
1. 左侧"auto switch"（自动切换）
2. 切换规则：

规则列表规则：
- 条件类型：规则列表
- 规则列表格式：AutoProxy
- 规则列表网址：
  https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt
- 情景模式：proxy
- 立即更新情景模式

默认情景模式：直接连接

规则列表规则：proxy
```

**规则列表URL推荐：**

```
GFWList（被墙网站列表）：
https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt

Loyalsoldier规则（推荐）：
https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/gfwlist.txt

CHNRoute（中国IP列表，反向规则）：
https://raw.githubusercontent.com/Loyalsoldier/v2ray-rules-dat/release/direct-list.txt
```

### 6.2.3 高级规则配置

**自定义切换规则：**

```
添加条件规则：

1. 域名通配符：
   条件类型：域名通配符
   条件设置：*.google.com
   情景模式：proxy

2. 主机名正则：
   条件类型：主机正则表达式
   条件设置：.*\.google\.com$
   情景模式：proxy

3. 网址通配符：
   条件类型：网址通配符
   条件设置：*://www.youtube.com/*
   情景模式：proxy

4. 网址正则：
   条件类型：网址正则表达式
   条件设置：^https?://.*\.facebook\.com/.*
   情景模式：proxy
```

**实用规则示例：**

```
代理国外网站：
*.google.com          → proxy
*.youtube.com         → proxy
*.facebook.com        → proxy
*.twitter.com         → proxy
*.instagram.com       → proxy
*.github.com          → proxy

直连国内网站：
*.baidu.com           → 直接连接
*.qq.com              → 直接连接
*.taobao.com          → 直接连接
*.jd.com              → 直接连接

本地地址直连：
127.0.0.1             → 直接连接
localhost             → 直接连接
192.168.*             → 直接连接
```

### 6.2.4 情景模式类型

**1. 代理服务器**
```
用途：基础代理配置
配置：单一代理服务器
适合：简单使用场景
```

**2. 自动切换**
```
用途：基于规则自动选择情景模式
配置：规则列表 + 条件规则
适合：日常使用（推荐）
```

**3. PAC情景模式**
```
用途：使用PAC脚本
配置：JavaScript函数
适合：高级用户

示例PAC脚本：
function FindProxyForURL(url, host) {
  if (shExpMatch(host, "*.google.com")) {
    return "SOCKS5 127.0.0.1:1080";
  }
  if (shExpMatch(host, "*.youtube.com")) {
    return "SOCKS5 127.0.0.1:1080";
  }
  return "DIRECT";
}
```

**4. 虚拟情景模式**
```
用途：组合其他情景模式
配置：按顺序尝试多个代理
适合：故障转移场景
```

### 6.2.5 快速切换技巧

**使用方法：**

```
点击浏览器工具栏SwitchyOmega图标：

选项：
○ 直接连接         # 不使用代理
○ 系统代理         # 使用系统代理设置
○ proxy           # 使用配置的代理
○ auto switch     # 自动切换模式（推荐）

快捷键：
可在选项中设置快捷键快速切换
```

**指示器颜色：**
```
🔵 蓝色：使用代理
⚪ 灰色：直接连接
🟢 绿色：自动切换（当前直连）
🟠 橙色：自动切换（当前代理）
```

### 6.2.6 导入导出配置

**导出配置：**
```
选项 → 导入/导出 → 生成备份文件
下载.bak或.json文件
保存配置，便于迁移
```

**导入配置：**
```
选项 → 导入/导出 → 从备份文件恢复
选择之前导出的文件
一键恢复所有配置
```

**在线恢复（推荐）：**
```
将配置文件上传到GitHub Gist
获取Raw链接
任何设备上：
选项 → 导入/导出 → 在线恢复
输入链接 → 恢复
```

### 6.2.7 安全使用建议

**防范插件风险：**

```
1. 从官方渠道下载：
   ✓ 仅使用Chrome/Firefox官方应用商店
   ❌ 避免第三方网站下载

2. 谨慎授予权限：
   ✓ 安装时仔细阅读权限说明
   ✓ 定期检查已安装插件的权限
   ⚠️ 过度权限请求需警惕

3. 定期检查更新：
   ✓ 保持插件为最新版本
   ✓ 关注安全通告
   ✓ 发现异常立即移除

4. 使用监控工具：
   ✓ 使用浏览器开发者工具监控网络请求
   ✓ 定期扫描系统查找后门

5. 如果发现插件被感染：
   ❌ 立即移除插件
   ❌ 更改所有相关账户密码
   ❌ 扫描系统查找恶意软件
   ❌ 监测账户活动
```

**开发者建议：**
```
1. 加强OAuth访问控制
2. 定期审计插件代码
3. 实时监测插件安全性
4. 使用双因素认证保护账户
```

**替代方案推荐：**
```
ZeroOmega：
✓ SwitchyOmega的分支版本
✓ 兼容Manifest V3
✓ 更好的安全性
✓ 持续维护
✓ 功能与SwitchyOmega完全相同

下载：
https://chromewebstore.google.com/detail/pfnededegaaopdmhkdmcofjmoldfiped
```

## 6.3 浏览器指纹防护

### 6.3.1 什么是浏览器指纹

**浏览器指纹定义：**

网站通过收集浏览器特征来识别和追踪用户，即使不使用Cookie。

**收集的信息：**
```
基础信息：
- User-Agent（浏览器版本）
- 屏幕分辨率
- 时区和语言
- 操作系统
- 安装的字体

高级信息：
- Canvas指纹（图形渲染特征）
- WebGL指纹（GPU信息）
- AudioContext指纹（音频处理）
- WebRTC（真实IP泄漏）
- 插件列表
- 硬件特征
```

**测试网站：**
```
https://browserleaks.com/
https://amiunique.org/
https://coveryourtracks.eff.org/

可以查看你的浏览器泄露了哪些信息
```

### 6.3.2 防护方法

**浏览器扩展：**

**1. uBlock Origin（广告拦截）**
```
功能：
- 拦截广告和追踪器
- 屏蔽恶意网站
- 减少指纹采集

安装：
Chrome/Firefox应用商店搜索"uBlock Origin"
```

**2. Privacy Badger（隐私獾）**
```
功能：
- 自动学习并屏蔽追踪器
- 保护隐私
- 防止指纹识别

由EFF开发，值得信赖
```

**3. Canvas Defender**
```
功能：
- 防止Canvas指纹追踪
- 添加随机噪声
- 保护隐私

使用：
安装后自动工作，无需配置
```

**4. WebRTC Leak Shield**
```
功能：
- 防止WebRTC泄露真实IP
- 保护代理效果

配置：
安装后选择"Disable non-proxied UDP"
```

### 6.3.3 浏览器设置优化

**Firefox隐私设置：**

```
1. 增强型跟踪保护：
   设置 → 隐私与安全 → 增强型跟踪保护 → 严格

2. Cookie设置：
   仅限同站Cookie
   或选择"删除Cookie和网站数据（Firefox关闭时）"

3. 阻止指纹识别：
   about:config
   privacy.resistFingerprinting = true

4. 禁用WebRTC：
   about:config
   media.peerconnection.enabled = false
```

**Chrome隐私设置：**

```
1. 预加载网页：
   设置 → 隐私和安全 → Cookie和其他网站数据
   关闭"预加载网页，以便实现更快速的浏览和搜索"

2. 不跟踪：
   发送"不跟踪"请求（效果有限）

3. 第三方Cookie：
   阻止第三方Cookie

4. 使用扩展插件：
   依赖上述提到的扩展
```

### 6.3.4 专业隐私浏览器

**Tor Browser（洋葱浏览器）：**
```
特点：
✓ 最强隐私保护
✓ 多层加密
✓ IP匿名化
✓ 防指纹追踪

下载：
https://www.torproject.org/

使用场景：
- 极度注重隐私
- 访问暗网
- 绕过严格审查

缺点：
✗ 速度较慢
✗ 部分网站可能屏蔽Tor
```

**Brave浏览器：**
```
特点：
✓ 内置广告拦截
✓ 默认HTTPS
✓ 防指纹追踪
✓ 速度快

下载：
https://brave.com/

优势：
- 基于Chromium，兼容性好
- 默认隐私保护
- 内置Tor模式
```

**Firefox Focus（移动端）：**
```
特点：
✓ 自动删除浏览历史
✓ 广告拦截
✓ 追踪保护
✓ 极简设计

适用：
iOS/Android
```

## 6.4 隐私浏览模式

### 6.4.1 无痕模式/隐私模式

**各浏览器开启方式：**

```
Chrome：
Ctrl + Shift + N (Windows/Linux)
Cmd + Shift + N (macOS)

Firefox：
Ctrl + Shift + P (Windows/Linux)
Cmd + Shift + P (macOS)

Edge：
Ctrl + Shift + N

Safari：
Cmd + Shift + N (macOS)
```

**隐私模式的作用：**
```
✓ 不保存浏览历史
✓ 不保存Cookie（关闭后清除）
✓ 不保存表单数据
✓ 不保存搜索记录

✗ 不能隐藏IP地址
✗ 不能防止ISP追踪
✗ 不能绕过网络限制
✗ 仍然可能被指纹识别
```

**常见误解：**
```
❌ 误解：隐私模式可以匿名上网
✅ 事实：只是不在本地保存记录

❌ 误解：ISP看不到我的访问
✅ 事实：ISP仍能看到所有流量

❌ 误解：网站无法追踪我
✅ 事实：仍可通过指纹、IP追踪
```

### 6.4.2 容器标签（Firefox）

**Firefox容器功能：**

```
安装：
Firefox Multi-Account Containers扩展

功能：
- 不同容器互相隔离
- Cookie不共享
- 可用于多账号登录
- 提高隐私保护

使用场景：
容器1：工作账号
容器2：个人账号  
容器3：购物
容器4：社交媒体

优势：
✓ 防止跨站追踪
✓ 多账号同时登录
✓ 隔离不同网站
```

**配置示例：**
```
创建容器：
1. 工作（蓝色）
2. 个人（绿色）
3. 购物（橙色）
4. 社交（粉色）

自动打开规则：
google.com → 工作容器
facebook.com → 社交容器
taobao.com → 购物容器
```

### 6.4.3 搜索引擎隐私

**隐私友好的搜索引擎：**

**DuckDuckGo：**
```
网址：https://duckduckgo.com

特点：
✓ 不追踪用户
✓ 不记录搜索历史
✓ 不个性化结果
✓ 加密连接

设置为默认：
浏览器设置 → 搜索引擎 → DuckDuckGo
```

**Startpage：**
```
网址：https://www.startpage.com

特点：
✓ 使用Google搜索结果
✓ 但不追踪用户
✓ 代理访问网站
✓ 保护隐私

优势：
- 搜索质量高（Google结果）
- 隐私保护好
```

**Searx（自托管）：**
```
特点：
✓ 开源搜索引擎
✓ 聚合多个搜索源
✓ 可自己部署
✓ 完全掌控

公共实例：
https://searx.space/
```

### 6.4.4 HTTPS Everywhere

**扩展功能：**
```
自动将HTTP升级为HTTPS
保护传输安全
防止中间人攻击

由EFF开发
```

**安装与使用：**
```
Chrome/Firefox应用商店搜索"HTTPS Everywhere"

功能：
- 自动检测HTTPS支持
- 强制使用HTTPS
- 保护隐私和安全

注意：
现代浏览器已内置类似功能
但该扩展提供更强制的保护
```

### 6.4.5 综合隐私方案

**推荐配置组合：**

**基础配置（所有用户）：**
```
✓ 浏览器：Firefox / Brave
✓ 扩展：
  - uBlock Origin（广告拦截）
  - Privacy Badger（追踪保护）
  - HTTPS Everywhere（强制HTTPS）
✓ 搜索引擎：DuckDuckGo
✓ DNS：加密DNS（DoH）
```

**进阶配置（注重隐私）：**
```
✓ 浏览器：Firefox + 严格隐私设置
✓ 扩展：
  - uBlock Origin
  - Privacy Badger
  - Canvas Defender
  - WebRTC Leak Shield
  - Decentraleyes（本地CDN）
✓ 容器标签：网站隔离
✓ 定期清除：Cookie和缓存
```

**极致配置（最高隐私）：**
```
✓ 浏览器：Tor Browser
✓ 代理：多层代理
✓ 虚拟机：隔离环境
✓ VPN + Tor：双重保护
✓ 定期更换：浏览器配置文件
```

---

## 本章小结

本章介绍了浏览器代理配置和隐私保护方案：

**核心要点：**

1. **浏览器代理**：
   - Chrome/Edge：使用系统代理或SwitchyOmega
   - Firefox：独立代理设置
   - Safari：系统代理

2. **SwitchyOmega**：
   - 自动切换规则
   - 多情景模式
   - 灵活配置

3. **指纹防护**：
   - 浏览器扩展保护
   - 隐私浏览器选择
   - 设置优化

4. **隐私模式**：
   - 无痕浏览
   - 容器隔离
   - 隐私搜索引擎

**最佳实践：**
```
日常使用：
浏览器 + SwitchyOmega + 基础隐私扩展

注重隐私：
Firefox + 容器 + 严格隐私设置

极致需求：
Tor Browser + VPN + 虚拟机
```

**注意事项：**
```
⚠️ 隐私保护要适度，过度配置可能影响体验
⚠️ 不同场景选择合适的方案
⚠️ 定期更新扩展和浏览器
⚠️ 了解各工具的局限性
```

至此，第二部分"主流协议与工具篇"全部完成！

---

**实践任务：**

1. 安装并配置SwitchyOmega
2. 测试浏览器指纹泄露情况
3. 尝试使用隐私友好的搜索引擎
4. 配置Firefox容器标签

**延伸阅读：**

- EFF隐私保护指南
- 浏览器指纹追踪技术
- Tor网络原理
- 现代隐私保护技术
