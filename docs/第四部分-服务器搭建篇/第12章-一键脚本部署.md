# 第12章 一键脚本部署

一键脚本大大简化了代理服务的部署过程，适合新手快速搭建。本章将介绍常用的一键脚本及使用方法。

## 12.1 V2Ray/Xray一键脚本

### 12.1.1 mack-a脚本（推荐）

**脚本特点：**

```
优势：
✓ 功能全面
✓ 支持多协议
✓ 支持Reality协议
✓ 自动配置伪装
✓ 自动申请证书
✓ 定期更新维护
✓ 中文友好

支持协议：
- VLESS + Reality（最新推荐）
- VLESS + TCP + TLS
- VLESS + TCP + XTLS
- VLESS + WS + TLS
- VLESS + gRPC + TLS
- Trojan + TCP + TLS
- Trojan + gRPC + TLS
- VMess + WS + TLS
- Hysteria 2
```

**安装步骤：**

```bash
# 1. 确保系统已更新
apt update && apt upgrade -y

# 2. 安装必要工具
apt install curl wget sudo -y

# 3. 运行一键脚本
wget -P /root -N --no-check-certificate "https://raw.githubusercontent.com/mack-a/v2ray-agent/master/install.sh" && chmod 700 /root/install.sh && /root/install.sh

# 4. 选择安装选项
# 菜单会自动显示，按数字选择：
# 1. 安装
# 2. 任意组合安装
# ...

# 推荐选择：
# VLESS + Reality（无需域名，2025最佳选择）
# 或
# VLESS + TCP + TLS / XTLS（性能最好）
# 或
# VLESS + gRPC + TLS（CDN友好）
```

**使用流程：**

```
步骤1：准备域名
- 域名已解析到服务器IP
- A记录：yourdomain.com → your-vps-ip

步骤2：运行脚本
- 选择安装类型
- 输入域名
- 输入邮箱（申请证书用）

步骤3：自动化处理
- 安装Nginx
- 申请Let's Encrypt证书
- 配置V2Ray/Xray
- 配置伪装网站

步骤4：获取配置
- 脚本会显示客户端配置
- 扫描二维码或复制链接
- 导入到客户端

步骤5：测试连接
- 客户端导入配置
- 测试连接
```

**管理命令：**

```bash
# 再次运行脚本进入管理菜单
/root/install.sh

# 常用选项：
# 1. 查看账号
# 2. 查看日志
# 3. 更新
# 4. 卸载
# 5. 更换伪装站
# 6. 更新证书
```

### 12.1.2 233boy脚本

**安装V2Ray：**

```bash
# 运行脚本
bash <(curl -s -L https://git.io/v2ray.sh)

# 或
wget -N https://raw.githubusercontent.com/233boy/v2ray/master/install.sh && bash install.sh

# 选择协议
# 推荐：
# 1. TCP
# 2. WebSocket + TLS（需要域名）
# 3. HTTP/2（需要域名）

# 如果选择TLS，需要：
# 1. 输入域名
# 2. 自动申请证书
# 3. 配置Nginx

# 安装完成后自动生成：
# - 配置信息
# - vmess://链接
# - 二维码
```

**管理命令：**

```bash
# 查看配置
v2ray info

# 查看二维码
v2ray qr

# 修改配置
v2ray config

# 查看状态
v2ray status

# 启动/停止/重启
v2ray start
v2ray stop
v2ray restart

# 更新
v2ray update

# 卸载
v2ray uninstall
```

### 12.1.3 Xray一键脚本

**安装Xray-core：**

```bash
# 官方安装脚本
bash -c "$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)" @ install

# 或指定版本
bash -c "$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)" @ install -u root

# 安装目录：
# 配置文件：/usr/local/etc/xray/config.json
# 日志目录：/var/log/xray/
# 执行文件：/usr/local/bin/xray

# 手动编辑配置
vi /usr/local/etc/xray/config.json

# 启动服务
systemctl start xray
systemctl enable xray

# 查看状态
systemctl status xray

# 查看日志
journalctl -u xray -f
```

**配置示例：**

```json
{
  "log": {
    "loglevel": "warning"
  },
  "inbounds": [{
    "port": 443,
    "protocol": "vless",
    "settings": {
      "clients": [{
        "id": "your-uuid-here",
        "flow": "xtls-rprx-vision"
      }],
      "decryption": "none"
    },
    "streamSettings": {
      "network": "tcp",
      "security": "tls",
      "tlsSettings": {
        "alpn": ["h2", "http/1.1"],
        "certificates": [{
          "certificateFile": "/path/to/fullchain.pem",
          "keyFile": "/path/to/privkey.pem"
        }]
      }
    }
  }],
  "outbounds": [{
    "protocol": "freedom"
  }]
}
```

## 12.2 Trojan一键安装

### 12.2.1 Trojan-Go一键脚本

**Jrohy脚本：**

```bash
# 运行安装脚本
bash <(curl -sL https://raw.githubusercontent.com/phlinhng/v2ray-tcp-tls-web/main/install.sh)

# 或
wget -N --no-check-certificate https://raw.githubusercontent.com/mark-tech/trojan-wiz/main/ins.sh && chmod +x ins.sh && bash ins.sh

# 安装流程：
# 1. 选择域名或IP
# 2. 输入域名（如果选择域名）
# 3. 选择是否配置CDN
# 4. 自动申请证书
# 5. 配置Trojan-Go
# 6. 配置伪装网站

# 安装完成显示：
# - 服务器地址
# - 端口
# - 密码
# - 客户端配置
```

**Trojan-Panel面板：**

```bash
# 安装面板（带Web管理界面）
bash <(curl -sL https://raw.githubusercontent.com/trojan-gfw/trojan-panel/master/install-ubuntu.sh)

# 访问面板
# https://your-domain:8888
# 默认用户名：admin
# 默认密码：admin（首次登录需修改）

# 面板功能：
# - 用户管理
# - 流量统计
# - 节点管理
# - 系统监控
```

### 12.2.2 Trojan-GFW原版安装

**使用Docker安装：**

```bash
# 安装Docker
curl -fsSL https://get.docker.com | bash

# 创建配置目录
mkdir -p /etc/trojan

# 创建配置文件
vi /etc/trojan/config.json

# 配置内容：
{
  "run_type": "server",
  "local_addr": "0.0.0.0",
  "local_port": 443,
  "remote_addr": "127.0.0.1",
  "remote_port": 80,
  "password": ["your_password_here"],
  "log_level": 1,
  "ssl": {
    "cert": "/etc/trojan/fullchain.pem",
    "key": "/etc/trojan/privkey.pem",
    "sni": "your-domain.com"
  }
}

# 运行Trojan容器
docker run -d \
  --name trojan \
  --restart always \
  -p 443:443 \
  -v /etc/trojan:/etc/trojan \
  trojangfw/trojan

# 查看日志
docker logs trojan
```

## 12.3 WireGuard快速部署

### 12.3.1 WireGuard一键脚本

**Angristan脚本（推荐）：**

```bash
# 下载并运行脚本
curl -O https://raw.githubusercontent.com/angristan/wireguard-install/master/wireguard-install.sh
chmod +x wireguard-install.sh
./wireguard-install.sh

# 安装流程：
# 1. 自动安装WireGuard
# 2. 生成服务器密钥对
# 3. 配置网络接口
# 4. 创建第一个客户端

# 输入配置：
# - 客户端名称
# - 内网IP地址
# - 是否启用NAT（选择yes）

# 完成后生成：
# - 配置文件：/root/wg0-client-xxx.conf
# - 二维码（移动端扫描）
```

**手动配置：**

```bash
# 安装WireGuard
# Ubuntu
apt install wireguard -y

# CentOS
yum install elrepo-release epel-release
yum install kmod-wireguard wireguard-tools

# 生成密钥对
cd /etc/wireguard
umask 077
wg genkey | tee server_privatekey | wg pubkey > server_publickey
wg genkey | tee client_privatekey | wg pubkey > client_publickey

# 创建服务器配置
vi /etc/wireguard/wg0.conf

[Interface]
PrivateKey = <server_privatekey内容>
Address = 10.0.0.1/24
ListenPort = 51820
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

[Peer]
PublicKey = <client_publickey内容>
AllowedIPs = 10.0.0.2/32

# 启动WireGuard
wg-quick up wg0
systemctl enable wg-quick@wg0

# 查看状态
wg show
```

**客户端配置：**

```ini
[Interface]
PrivateKey = <client_privatekey内容>
Address = 10.0.0.2/24
DNS = 1.1.1.1

[Peer]
PublicKey = <server_publickey内容>
Endpoint = your-server-ip:51820
AllowedIPs = 0.0.0.0/0
PersistentKeepalive = 25
```

### 12.3.2 WireGuard-UI面板

**使用Docker安装：**

```bash
# 运行WireGuard-UI
docker run -d \
  --name wgui \
  --cap-add NET_ADMIN \
  --cap-add SYS_MODULE \
  -e WGUI_USERNAME=admin \
  -e WGUI_PASSWORD=password \
  -e WG_CONF_DIR=/etc/wireguard \
  -e WG_INTERFACE_NAME=wg0 \
  -p 5000:5000 \
  -p 51820:51820/udp \
  -v /etc/wireguard:/etc/wireguard \
  -v /lib/modules:/lib/modules \
  ngoduykhanh/wireguard-ui

# 访问Web界面
http://your-server-ip:5000
# 用户名：admin
# 密码：password
```

## 12.4 脚本安全性分析

### 12.4.1 脚本安全风险

**潜在风险：**

```
1. 代码注入
   恶意脚本可能：
   ✗ 安装后门
   ✗ 窃取密钥
   ✗ 修改系统配置
   ✗ 上传数据到攻击者服务器

2. 权限滥用
   脚本通常需要root权限
   ✗ 可以执行任何操作
   ✗ 修改关键系统文件

3. 依赖风险
   脚本会下载第三方组件
   ✗ 下载地址被劫持
   ✗ 组件本身有漏洞

4. 更新风险
   自动更新功能
   ✗ 可能引入恶意代码
```

### 12.4.2 使用脚本的安全建议

**使用前检查：**

```bash
# 1. 查看脚本源码
curl -s URL | less
# 仔细阅读代码
# 检查是否有可疑操作

# 2. 检查脚本来源
# 优先使用：
# ✓ GitHub官方仓库
# ✓ 知名开发者
# ✓ Star数多、更新活跃的项目
# ✓ 有详细文档和说明

# 避免使用：
# ✗ 来源不明的脚本
# ✗ 无法查看源码
# ✗ 长期不更新的项目
# ✗ 无人维护的fork

# 3. 使用沙箱环境测试
# 先在测试VPS上运行
# 确认安全后再用于正式环境
```

**推荐的安全脚本：**

```
V2Ray/Xray：
✓ mack-a脚本 - GitHub Star 3000+
✓ 233boy脚本 - 老牌脚本，使用广泛
✓ Xray官方安装脚本

Trojan：
✓ Trojan-Panel官方脚本
✓ Jrohy维护的脚本

WireGuard：
✓ Angristan脚本 - Star 3000+
✓ 官方安装包

判断标准：
- GitHub Star数 > 1000
- 最近更新时间 < 6个月
- Issues有人回复
- 代码可读性好
- 有详细文档
```

### 12.4.3 手动安装 vs 一键脚本

**对比：**

| 维度 | 一键脚本 | 手动安装 |
|-----|---------|---------|
| **难度** | ⭐ 简单 | ⭐⭐⭐⭐ 困难 |
| **速度** | ⭐⭐⭐⭐⭐ 快 | ⭐⭐ 慢 |
| **可控性** | ⭐⭐ 低 | ⭐⭐⭐⭐⭐ 高 |
| **安全性** | ⭐⭐⭐ 取决于脚本 | ⭐⭐⭐⭐⭐ 最安全 |
| **定制性** | ⭐⭐ 有限 | ⭐⭐⭐⭐⭐ 完全自由 |
| **维护** | ⭐⭐⭐⭐ 脚本自动 | ⭐⭐ 需要自己 |

**选择建议：**

```
推荐使用一键脚本：
✓ 新手用户
✓ 快速部署
✓ 个人使用
✓ 不需要特殊配置

推荐手动安装：
✓ 有Linux经验
✓ 追求安全
✓ 需要定制配置
✓ 企业级部署
✓ 学习目的
```

### 12.4.4 脚本使用最佳实践

**安全使用流程：**

```bash
# 1. 创建快照/备份
# 在VPS控制面板创建快照
# 或使用rsync备份重要数据

# 2. 下载脚本到本地查看
wget URL -O script.sh
cat script.sh | less
# 检查可疑代码

# 3. 在测试环境运行
# 使用廉价VPS测试
# 观察脚本行为

# 4. 限制脚本权限（如果可能）
# 某些操作不需要完整root权限
chmod +x script.sh
sudo -u limited-user ./script.sh

# 5. 记录安装过程
script install.log
bash script.sh
exit
# 日志保存在install.log

# 6. 安装后检查
# 查看新增的服务
systemctl list-units --type=service | grep -i v2ray

# 查看开放的端口
netstat -tulnp

# 查看定时任务
crontab -l

# 检查启动项
ls /etc/systemd/system/

# 7. 定期更新
# 使用脚本的更新功能
# 或关注项目更新动态
```

---

## 本章小结

本章介绍了常用的一键脚本及使用方法：

**核心要点：**

1. **V2Ray/Xray脚本**：
    - mack-a：功能全面，支持多协议
    - 233boy：简单易用，老牌稳定
    - Xray官方：轻量级，适合DIY

2. **Trojan脚本**：
    - Trojan-Go：性能优秀
    - Trojan-Panel：Web管理界面
    - 官方版本：简洁稳定

3. **WireGuard脚本**：
    - Angristan：简单易用
    - WireGuard-UI：图形化管理
    - 手动配置：完全掌控

4. **安全性**：
    - 检查脚本来源
    - 查看源码
    - 沙箱测试
    - 定期更新

**使用建议：**

```
新手推荐：
mack-a V2Ray/Xray脚本
理由：全自动、傻瓜式、功能完整

进阶用户：
官方安装脚本 + 手动配置
理由：可控、安全、灵活

企业使用：
完全手动部署
理由：安全、可审计、可定制
```

**注意事项：**

```
⚠️ 一键脚本虽然方便，但要注意：
- 仅使用知名、可信的脚本
- 定期检查更新
- 不要在生产环境盲目使用
- 了解脚本的基本操作
- 保留手动配置的学习计划
```

下一章我们将学习手动部署的完整流程。

---

**实践任务：**

1. 使用mack-a脚本部署V2Ray
2. 配置域名和TLS证书
3. 测试客户端连接
4. 尝试Trojan部署
5. 对比不同协议性能
